var FrameMessenging;!function($){FrameMessenging={windowProxy:null,guestDomain:"",language:"en",init:function(guestDomain,language){FrameMessenging.guestDomain=guestDomain,FrameMessenging.language=language,FrameMessenging.windowProxy=new Porthole.WindowProxy(FrameMessenging.guestDomain+"/MyPrivilege.aspx?language="+FrameMessenging.language,"IBEFrame"),FrameMessenging.windowProxy.addEventListener(FrameMessenging.onMessage)},getUrlVars:function(){for(var hash,vars=[],hashes=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),i=0;i<hashes.length;i++)hash=hashes[i].split("="),vars.push(hash[0]),vars[hash[0]]=hash[1];return vars},getUrlVar:function(name){return void 0===FrameMessenging.getUrlVars()[name]?"":FrameMessenging.getUrlVars()[name]},onMessage:function(messageEvent){var $header;if(messageEvent.data.html)$.extend($.validator.messages,messageEvent.data.validation),$.when($("<div />").addClass("myprivilege").html(messageEvent.data.html).insertAfter($(".global-nav"))).done(function(){$(".myprivilege input").each(function(){$(this).next().is("label")&&$(this).next("label").detach().insertBefore($(this)),$(this).on("focus",function(){$(this).parent().addClass("is-focused")}).on("blur",function(){""==$(this).val()&&$(this).parent().removeClass("is-focused")})})}),$("#dialogCookie").parent().remove(),$(".js-my-booking").on("click",function(e){e.preventDefault(),e.stopPropagation(),$("#lnkMyBooking").trigger("click"),$(this).addClass("is-active"),$(".myprivilege").addClass("is-active"),$(".js-my-login, .js-my-signup").removeClass("is-active")}),$(".js-my-login").attr("href",$("#lnkMyProfile").attr("href")+"?reurl="+encodeURIComponent(window.location.href)),$(".js-my-signup").attr("href",$("#lnkSignup").attr("href")+"?reurl="+encodeURIComponent(window.location.href)),$('a[href*="#signUpPopup"]').on("click",function(e){e.preventDefault(),$(".js-my-login, .js-my-booking").removeClass("is-active"),window.location.href=$(".js-my-signup").attr("href")}),$('a[href*="#loginPopup"]').on("click",function(e){e.preventDefault(),$(".js-my-booking, .js-my-signup").removeClass("is-active"),window.location.href=$(".js-my-login").attr("href")}),$(".myBookingPopupClose, html").click(function(){$(".js-my-login, .js-my-booking, .js-my-signup").removeClass("is-active"),$(".myprivilege").removeClass("is-active")}),Login.__init__(!0,FrameMessenging.guestDomain,FrameMessenging.windowProxy),$("html").on("click",function(e){$("#myBookingPopup").is(":visible")&&($("a#lnkMyBooking").removeClass("hover"),$("#myBookingPopup").slideUp({duration:250,queue:!1}),$("body").removeClass("noscroll"))}),$("a#lnkMyBooking").unbind().bind("click",function(event){var isShown=$("#myBookingPopup").is(":visible");return enquire.register("screen and (max-width: 1023px)",{match:function(){!function($header,section,$bookingToggle){var $langSelector=$(".header-tools",$header),$bookingSubtitle=$(".booking-form-subtitle",$header),langHeight=0,bookingSubtitleHeight=0,globalHeight=0;$langSelector.is(":visible")&&(langHeight=$langSelector.outerHeight()),$(".global-nav").is(":visible")&&(globalHeight=$(".global-nav").outerHeight()),$bookingSubtitle.is(":visible")&&(bookingSubtitleHeight=$bookingSubtitle.outerHeight()),section.css("maxHeight",$(window).outerHeight()-$bookingToggle.outerHeight()-globalHeight-langHeight-bookingSubtitleHeight)}($header,$(".myprivilege"),$("a#lnkMyBooking"))},unmatch:function(){$(".myprivilege").css("max-height","calc(100vh - 70px)")}}).register("screen and (min-width: 1024px)",{match:function(){$(".myprivilege").css("max-height","calc(100vh - 70px)")}}),isShown?($("a#lnkMyBooking").removeClass("hover"),$("#myBookingPopup").slideUp({duration:250,queue:!1}),$("body").removeClass("noscroll")):($(".myprivilege li a").removeClass("hover"),$(".myprivilege .dialog").slideUp({duration:0,queue:!1}),clearTimeout(Login.timer),$(this).addClass("hover"),$("#myBookingPopup").slideDown({duration:250,queue:!1}),$("#bookingnumber").focus(),enquire.register("screen and (max-width: 1023px)",{match:function(){$("body").addClass("noscroll")},unmatch:function(){$("body").removeClass("noscroll")}})),!1}),$(".myBookingPopupClose").click(function(){$("body").removeClass("noscroll"),$("a#lnkMyProfile").removeClass("hover"),$("#loginPopup").slideUp({duration:250,queue:!1}),$("a#lnkMyBooking").removeClass("hover"),$("#myBookingPopup").slideUp({duration:250,queue:!1}),$("a#lnkSignup").removeClass("hover"),$("#signupPopup").slideUp({duration:250,queue:!1})}),$("a#lnkWelcome").unbind().bind("mouseenter click",function(event){return clearTimeout(Login.timer),$(this).addClass("hover"),$("#myProfile .menu").slideDown({duration:250,queue:!1}),!1}),$("#myProfile").unbind().bind("mouseleave",function(event){Login.timer=setTimeout(function(){$("a#lnkWelcome").removeClass("hover"),$("#myProfile .menu").slideUp({duration:250,queue:!1})},200)}).bind("mouseenter",function(event){clearTimeout(Login.timer)}),messageEvent.data.profile?(window.guest_profile=messageEvent.data.profile,$.ajax({url:"/api/saveprofileinfo",type:"POST",cache:!1,timeout:1e4,data:$.param(window.guest_profile)}),$("body").addClass("is-members"),$("body").trigger("member-profile-change"),$(".members-visit-only").show(),$(".public-visit-only, .js-my-signup").hide()):($("body").removeClass("is-members"),$(".members-visit-only").hide(),$(".public-visit-only").show());else if(messageEvent.data.StatusFail)$("#loginUnsuccessful").show();else if(messageEvent.data.reqOWSId)$.fancybox.open($("#linkFBAccount"),{modal:!0,padding:0,helpers:{overlay:{closeClick:!1,css:{background:"rgba(255,255,255,0.8)"},locked:!0}},afterClose:function(){location.reload()}}),$("#frmFacebookConfirmPassword").focus();else if(messageEvent.data.hideAgent)$(".global-nav .js-my-login, .global-nav .js-my-signup, .global-nav .js-my-booking, .js-privilege-form").hide(),"rtl"===$("html").attr("dir")?$(".global-nav").css({"padding-left":"210px"}):$(".global-nav").css({"padding-right":"210px"}),$('option[value="tacode"], li[data-raw-value="tacode"]').remove();else if(!messageEvent.data.HideLoadingOverlay)if(messageEvent.data.signupnewfail)$("#SignUpStatus").html(messageEvent.data.message).show();else if(messageEvent.data.fbconfirmpasswordfail)$("#lblerror").html(messageEvent.data.message);else if(messageEvent.data.redirectAfterLogin)Login.redirectAfterLogin(messageEvent.data.result);else if(messageEvent.data.forgetResult)$("#forgetResultArea").html(messageEvent.data.message).show(),"success"==messageEvent.data.status?($("#forgetResultArea").removeClass("error"),$("#frmForgetPassword, #forgetPasswordTitle").hide().css({visibility:"visible"})):($("#forgetResultArea").addClass("error"),$("#frmForgetPassword, #forgetPasswordTitle").css({visibility:"visible"}));else if(messageEvent.data.displayloyaltymessage)$("#joinnow .errmsg").html(messageEvent.data.message).show();else if(messageEvent.data.bookingcookie_found){return}else messageEvent.data.bookingcookie_notfound?($("header, main").removeClass("has-finished-booking"),messageEvent.data.haveacode_click&&$("#haveacode, #haveacode2").click()):messageEvent.data.clearBookingCookieSuccess?($("#deviceCover").show(),$("#finishBooking").hide(),$("#bookingDevice").is(":visible")||$("#deviceCover h4").click(),"function"==typeof googleTracking&&googleTracking("/reservation/newbooking")):messageEvent.data.addToken?jQuery("#frmSignUp, #frmJoinGHA").append('<input type="hidden" name="hidCT" value="'+messageEvent.data.result+'" />'):messageEvent.data.reload&&location.reload()}}}($j);